<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiAnime API Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .playground {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .main-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .endpoint-group {
            margin-bottom: 20px;
        }
        
        .endpoint-group h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .endpoint-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 0.9em;
        }
        
        .endpoint-btn:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(4px);
        }
        
        .endpoint-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .method {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8em;
            margin-right: 8px;
        }
        
        .method.get {
            background: #28a745;
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group .hint {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .response-section {
            margin-top: 30px;
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .response-header h3 {
            color: #495057;
        }
        
        .copy-btn {
            padding: 6px 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .response-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .request-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .request-info strong {
            color: #0056b3;
        }
        
        @media (max-width: 1024px) {
            .playground {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: relative;
                top: 0;
            }
        }

        /* JSON Syntax Highlighting */
        .json-key { color: #9cdcfe; }
        .json-string { color: #ce9178; }
        .json-number { color: #b5cea8; }
        .json-boolean { color: #569cd6; }
        .json-null { color: #569cd6; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÆ HiAnime API Playground</h1>
        <p>Interactive API Testing - Pure Client-Side JavaScript</p>
    </div>
    
    <div class="container">
        <div style="text-align: center; margin: 20px 0;">
            <a href="/" style="color: #667eea; text-decoration: none; margin: 0 15px;">‚Üê Home</a>
            <a href="/doc" style="color: #667eea; text-decoration: none; margin: 0 15px;">Documentation</a>
        </div>
        
        <div class="playground">
            <div class="sidebar">
                <h2 style="margin-bottom: 20px; color: #495057;">API Endpoints</h2>
                
                <div class="endpoint-group">
                    <h3>üìä General</h3>
                    <button class="endpoint-btn" data-endpoint="home">
                        <span class="method get">GET</span>
                        Home Page Data
                    </button>
                </div>
                
                <div class="endpoint-group">
                    <h3>üîç Search</h3>
                    <button class="endpoint-btn" data-endpoint="search">
                        <span class="method get">GET</span>
                        Search Anime
                    </button>
                    <button class="endpoint-btn" data-endpoint="suggestion">
                        <span class="method get">GET</span>
                        Search Suggestions
                    </button>
                </div>
                
                <div class="endpoint-group">
                    <h3>üì∫ Streaming</h3>
                    <button class="endpoint-btn" data-endpoint="servers">
                        <span class="method get">GET</span>
                        Episode Servers
                    </button>
                    <button class="endpoint-btn" data-endpoint="stream">
                        <span class="method get">GET</span>
                        Stream Links
                    </button>
                </div>
            </div>
            
            <div class="main-content">
                <div id="endpoint-form">
                    <h2 style="margin-bottom: 20px; color: #495057;">Select an endpoint to test</h2>
                    <p style="color: #6c757d;">Click on any endpoint from the sidebar to start testing the API.</p>
                </div>
                
                <div id="response-container" style="display: none;">
                    <div class="response-section">
                        <div class="response-header">
                            <h3>Response <span id="status-badge"></span></h3>
                            <button class="copy-btn" onclick="copyResponse()">üìã Copy Response</button>
                        </div>
                        <div id="request-info" class="request-info" style="display: none;"></div>
                        <div class="response-box" id="response-content">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = '/api/v1';
        
        // Current state
        let currentEndpoint = null;
        let lastResponse = null;
        
        // Endpoint configurations
        const endpoints = {
            home: {
                title: 'Home Page Data',
                path: '/home',
                params: [],
                description: 'Get spotlight, trending, top airing, latest episodes, genres, and more.'
            },
            search: {
                title: 'Search Anime',
                path: '/search',
                params: [
                    { name: 'keyword', type: 'text', required: true, placeholder: 'e.g., naruto', hint: 'Search keyword' },
                    { name: 'page', type: 'number', required: false, placeholder: '1', hint: 'Page number (optional)' }
                ],
                description: 'Search for anime by keyword.'
            },
            suggestion: {
                title: 'Search Suggestions',
                path: '/search/suggestion',
                params: [
                    { name: 'keyword', type: 'text', required: true, placeholder: 'e.g., one', hint: 'Search keyword for suggestions' }
                ],
                description: 'Get search suggestions as you type.'
            },
            servers: {
                title: 'Episode Servers',
                path: '/servers',
                params: [
                    { name: 'id', type: 'text', required: true, placeholder: 'e.g., steinsgate-3?ep=1', hint: 'Episode ID' }
                ],
                description: 'Get available streaming servers for an episode.'
            },
            stream: {
                title: 'Stream Links',
                path: '/stream',
                params: [
                    { name: 'id', type: 'text', required: true, placeholder: 'e.g., steinsgate-3?ep=1', hint: 'Episode ID' },
                    { name: 'server', type: 'text', required: true, placeholder: 'e.g., hd-1', hint: 'Server name' },
                    { name: 'type', type: 'select', required: false, options: ['sub', 'dub', 'raw'], hint: 'Stream type (default: sub)' }
                ],
                description: 'Get HLS streaming links with subtitles and intro/outro timestamps.'
            }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
        });
        
        // Setup event listeners
        function setupEventListeners() {
            document.querySelectorAll('.endpoint-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const endpoint = e.currentTarget.dataset.endpoint;
                    selectEndpoint(endpoint);
                });
            });
        }
        
        // Select endpoint
        function selectEndpoint(endpointKey) {
            currentEndpoint = endpointKey;
            
            // Update active button
            document.querySelectorAll('.endpoint-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-endpoint="${endpointKey}"]`).classList.add('active');
            
            // Render form
            renderEndpointForm(endpoints[endpointKey]);
            
            // Hide response initially
            document.getElementById('response-container').style.display = 'none';
        }
        
        // Render endpoint form
        function renderEndpointForm(endpoint) {
            const formContainer = document.getElementById('endpoint-form');
            
            let formHTML = `
                <h2 style="margin-bottom: 10px; color: #495057;">${endpoint.title}</h2>
                <p style="color: #6c757d; margin-bottom: 20px;">${endpoint.description}</p>
                <form id="api-form" onsubmit="submitRequest(event)">
            `;
            
            if (endpoint.params.length === 0) {
                formHTML += `
                    <p style="background: #e7f3ff; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        ‚ÑπÔ∏è This endpoint doesn't require any parameters.
                    </p>
                `;
            } else {
                endpoint.params.forEach(param => {
                    formHTML += `
                        <div class="form-group">
                            <label>
                                ${param.name} ${param.required ? '<span style="color: red;">*</span>' : ''}
                            </label>
                    `;
                    
                    if (param.type === 'select') {
                        formHTML += `<select name="${param.name}" ${param.required ? 'required' : ''}>`;
                        formHTML += `<option value="">Select ${param.name}</option>`;
                        param.options.forEach(opt => {
                            formHTML += `<option value="${opt}">${opt}</option>`;
                        });
                        formHTML += `</select>`;
                    } else {
                        formHTML += `
                            <input 
                                type="${param.type}" 
                                name="${param.name}" 
                                placeholder="${param.placeholder}"
                                ${param.required ? 'required' : ''}
                            >
                        `;
                    }
                    
                    formHTML += `
                            <div class="hint">${param.hint}</div>
                        </div>
                    `;
                });
            }
            
            formHTML += `
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        üöÄ Send Request
                    </button>
                </form>
            `;
            
            formContainer.innerHTML = formHTML;
        }
        
        // Submit request
        async function submitRequest(event) {
            event.preventDefault();
            
            const endpoint = endpoints[currentEndpoint];
            const formData = new FormData(event.target);
            const params = {};
            
            // Collect form data
            for (let [key, value] of formData.entries()) {
                if (value) params[key] = value;
            }
            
            // Build URL
            const queryString = new URLSearchParams(params).toString();
            const url = API_BASE + endpoint.path + (queryString ? '?' + queryString : '');
            
            // Show response container
            document.getElementById('response-container').style.display = 'block';
            document.getElementById('response-content').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Sending request...</span>
                </div>
            `;
            
            // Show request info
            document.getElementById('request-info').style.display = 'block';
            document.getElementById('request-info').innerHTML = `
                <strong>Request:</strong> GET ${url}
            `;
            
            // Disable button
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Loading...';
            
            try {
                const startTime = Date.now();
                const response = await fetch(url);
                const duration = Date.now() - startTime;
                const data = await response.json();
                
                lastResponse = data;
                
                // Update status
                const statusBadge = document.getElementById('status-badge');
                if (response.ok) {
                    statusBadge.className = 'status-badge status-success';
                    statusBadge.textContent = `${response.status} OK (${duration}ms)`;
                } else {
                    statusBadge.className = 'status-badge status-error';
                    statusBadge.textContent = `${response.status} Error`;
                }
                
                // Display response with syntax highlighting
                document.getElementById('response-content').innerHTML = syntaxHighlight(JSON.stringify(data, null, 2));
                
            } catch (error) {
                const statusBadge = document.getElementById('status-badge');
                statusBadge.className = 'status-badge status-error';
                statusBadge.textContent = 'Network Error';
                
                document.getElementById('response-content').innerHTML = syntaxHighlight(JSON.stringify({
                    error: error.message,
                    details: 'Failed to fetch from API. Please check your connection.'
                }, null, 2));
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ Send Request';
            }
        }
        
        // Syntax highlighting for JSON
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        // Copy response to clipboard
        function copyResponse() {
            if (!lastResponse) return;
            
            const text = JSON.stringify(lastResponse, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#28a745';
                }, 2000);
            });
        }
    </script>
</body>
</html>
